"use strict";(self.webpackChunkway23=self.webpackChunkway23||[]).push([[5045],{33728:(n,e,s)=>{s.r(e),s.d(e,{data:()=>a});const a={key:"v-1ffd9199",path:"/db-prometheus.html",title:"Базы данных: Prometheus",lang:"ru-RU",frontmatter:{title:"Базы данных: Prometheus",date:"2025-01-02",categories:["Базы данных"],tags:["Prometheus","Time-series database"]},excerpt:"",headers:[{level:2,title:"Запуск",slug:"запуск",children:[]},{level:2,title:"Web-интерфейс",slug:"web-интерфеис",children:[]},{level:2,title:"Пример на Python",slug:"пример-на-python",children:[]},{level:2,title:"Ссылки",slug:"ссылки",children:[]}],filePathRelative:"db-prometheus.md",git:{updatedTime:1735834515e3}}},50639:(n,e,s)=>{s.r(e),s.d(e,{default:()=>J});var a=s(66252),t=s(3577);const r={id:"frontmatter-title",tabindex:"-1"},p=(0,a._)("a",{class:"header-anchor",href:"#frontmatter-title","aria-hidden":"true"},"#",-1),l={href:"https://prometheus.io",target:"_blank",rel:"noopener noreferrer"},o=(0,a.Uk)("Prometheus"),u=(0,a.Uk)(" — база данных типа Time-series database."),c=(0,a._)("p",null,"Базу данных типа Time-series database можно представить как хранилище для набора key-value в котором ключом будет время, а значением некоторый показатель метрики. Однако, таким образом различные метрики перепутались бы, поэтому временные последовательности (последовательности ключей-времени) группируются по названиям метрики.",-1),i=(0,a._)("p",null,"Метрики могут быть нескольких типов:",-1),h=(0,a._)("ul",null,[(0,a._)("li",null,"Counter — может только увеличиваться"),(0,a._)("li",null,"Gauge — может уменьшаться и увеличиваться")],-1),m=(0,a._)("h2",{id:"запуск",tabindex:"-1"},[(0,a._)("a",{class:"header-anchor",href:"#запуск","aria-hidden":"true"},"#"),(0,a.Uk)(" Запуск")],-1),k=(0,a.Uk)("Запустить Prometheus проще всего через docker. Придется поднять два контейнера: "),b={href:"https://hub.docker.com/r/prom/prometheus",target:"_blank",rel:"noopener noreferrer"},d=(0,a.Uk)("Prometheus"),g=(0,a.Uk)(" и "),y={href:"https://hub.docker.com/r/prom/pushgateway",target:"_blank",rel:"noopener noreferrer"},_=(0,a.Uk)("Pushgateway"),f=(0,a.Uk)(". Второй нужен чтобы отправлять в Prometheus метрики по http."),w=(0,a.uE)('<p>Создайте файл <code>prometheus.yml</code>:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">global</span><span class="token punctuation">:</span>\n  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s\n\n<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>\n  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">&#39;pushgateway&#39;</span>\n    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;pushgateway:9091&#39;</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>docker network create prometheus-network\n\ndocker run -d --name pushgateway --network prometheus-network -p <span class="token number">9091</span>:9091 prom/pushgateway\n\ndocker run -d --name prometheus --network prometheus-network -p <span class="token number">9090</span>:9090 -v <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus --config.file<span class="token operator">=</span>/etc/prometheus/prometheus.yml\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>При такой конфигурации Prometheus будет забирать метрики из Pushgateway каждые 15 секунд.</p><h2 id="web-интерфеис" tabindex="-1"><a class="header-anchor" href="#web-интерфеис" aria-hidden="true">#</a> Web-интерфейс</h2><p>Prometheus поддерживает web-интерфейс для администрирования. После запуска контейнера интерфейс будет доступен по адресу <code>localhost:9090</code>.</p><h2 id="пример-на-python" tabindex="-1"><a class="header-anchor" href="#пример-на-python" aria-hidden="true">#</a> Пример на Python</h2>',7),v=(0,a.Uk)("Пример использования библиотеки "),P={href:"https://github.com/pyeventsourcing/esdbclient",target:"_blank",rel:"noopener noreferrer"},U=(0,a.Uk)("esdbclient"),W=(0,a.Uk)(":"),x=(0,a.uE)('<div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> prometheus_client <span class="token keyword">import</span> Counter<span class="token punctuation">,</span> push_to_gateway\n\ncounter <span class="token operator">=</span> Counter<span class="token punctuation">(</span><span class="token string">&#39;errors&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Errors in my app&#39;</span><span class="token punctuation">)</span>\n\n<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>\n    counter<span class="token punctuation">.</span>inc<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    push_to_gateway<span class="token punctuation">(</span><span class="token string">&#39;localhost:9091&#39;</span><span class="token punctuation">,</span> job<span class="token operator">=</span><span class="token string">&#39;my_job&#39;</span><span class="token punctuation">,</span> registry<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>\n    <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Pushgateway не хранит значения метрик, поэтому их значение нужно сохранять в приложении.</p><h2 id="ссылки" tabindex="-1"><a class="header-anchor" href="#ссылки" aria-hidden="true">#</a> Ссылки</h2>',3),C={href:"https://www.youtube.com/playlist?list=PLyBW7UHmEXgylLwxdVbrBQJ-fJ_jMvh8h",target:"_blank",rel:"noopener noreferrer"},T=(0,a.Uk)("Плейлист Prometheus Fundamentals"),j={href:"https://prometheus.io/docs/practices/pushing/",target:"_blank",rel:"noopener noreferrer"},E=(0,a.Uk)("When to use the Pushgateway"),H={href:"https://github.com/prometheus/prometheus",target:"_blank",rel:"noopener noreferrer"},G=(0,a.Uk)("GutHub Prometheus"),L={href:"https://github.com/Prometheus/pushgateway",target:"_blank",rel:"noopener noreferrer"},B=(0,a.Uk)("GutHub Pushgateway"),J={render:function(n,e){const s=(0,a.up)("OutboundLink");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("h1",r,[p,(0,a.Uk)(" "+(0,t.zw)(n.$frontmatter.title),1)]),(0,a._)("p",null,[(0,a._)("a",l,[o,(0,a.Wm)(s)]),u]),c,i,h,m,(0,a._)("p",null,[k,(0,a._)("a",b,[d,(0,a.Wm)(s)]),g,(0,a._)("a",y,[_,(0,a.Wm)(s)]),f]),w,(0,a._)("p",null,[v,(0,a._)("a",P,[U,(0,a.Wm)(s)]),W]),x,(0,a._)("ul",null,[(0,a._)("li",null,[(0,a._)("a",C,[T,(0,a.Wm)(s)])]),(0,a._)("li",null,[(0,a._)("a",j,[E,(0,a.Wm)(s)])]),(0,a._)("li",null,[(0,a._)("a",H,[G,(0,a.Wm)(s)])]),(0,a._)("li",null,[(0,a._)("a",L,[B,(0,a.Wm)(s)])])])],64)}}}}]);