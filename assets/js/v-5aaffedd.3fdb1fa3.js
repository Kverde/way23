"use strict";(self.webpackChunkway23=self.webpackChunkway23||[]).push([[1117],{46527:(a,n,s)=>{s.r(n),s.d(n,{data:()=>e});const e={key:"v-5aaffedd",path:"/metabase-%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D1%8B-%D0%B2-sql.html",title:"Metabase. Параметры в SQL",lang:"ru-RU",frontmatter:{title:"Metabase. Параметры в SQL",date:"2019-09-17",categories:["Программы"],tags:["перевод","metabase"]},excerpt:"",headers:[{level:2,title:"Определение переменной",slug:"определение-переменнои",children:[]},{level:2,title:"Тип переменной Field Filter",slug:"тип-переменнои-field-filter",children:[]},{level:2,title:"Создание фильтров SQL-вопроса используя переменные field filter",slug:"создание-фильтров-sql-вопроса-используя-переменные-field-filter",children:[]},{level:2,title:"Значение по умолчанию",slug:"значение-по-умолчанию",children:[]},{level:2,title:"Значение по умолчанию в запросе",slug:"значение-по-умолчанию-в-запросе",children:[]},{level:2,title:"Необязательное выражение",slug:"необязательное-выражение",children:[]},{level:2,title:"Далее: Автоматическое x-ray исследование",slug:"далее-автоматическое-x-ray-исследование",children:[]}],filePathRelative:"metabase-параметры-в-sql.md",git:{updatedTime:1692859375e3}}},28548:(a,n,s)=>{s.r(n),s.d(n,{default:()=>C});var e=s(66252),l=s(3577);const t={id:"frontmatter-title",tabindex:"-1"},p=(0,e._)("a",{class:"header-anchor",href:"#frontmatter-title","aria-hidden":"true"},"#",-1),o=(0,e.Uk)("Перевод страницы документации Metabase "),i={href:"https://metabase.com/docs/v0.33.0/users-guide/13-sql-parameters.html",target:"_blank",rel:"noopener noreferrer"},c=(0,e.Uk)("SQL Parameters"),r=(0,e.Uk)("."),d=(0,e._)("p",null,"Переменные, добавленные в SQL запросы, позволяют динамически заменять значения в запросе используя виджеты или через URL запроса.",-1),u=(0,e._)("p",null,[(0,e._)("img",{src:"images/metabase_var_01_02-widget.png",alt:"Виджет фильтра в Metabase"})],-1),k=(0,e._)("p",null,[(0,e.Uk)("Настройки переменных появляются в панели "),(0,e._)("strong",null,"Variables"),(0,e.Uk)(" редактора запросов после добавления переменных.")],-1),b=(0,e._)("p",null,[(0,e._)("img",{src:"images/metabase_var_02_01-variables.png",alt:"настройка переменной Metabase"})],-1),m=(0,e._)("h2",{id:"определение-переменнои",tabindex:"-1"},[(0,e._)("a",{class:"header-anchor",href:"#определение-переменнои","aria-hidden":"true"},"#"),(0,e.Uk)(" Определение переменной")],-1),g=(0,e.Uk)("Добавление "),h=(0,e.Uk)(" в запрос создаёт переменную с названием "),f=(0,e._)("code",null,"variable_name",-1),v=(0,e.Uk)(". Тип переменной и её поведение меняется на боковой панели. Все типы переменных кроме "),E=(0,e._)("code",null,"field filter",-1),y=(0,e.Uk)(" добавляют соответствующий виджет в вопрос. Когда в виджите выбрано значение, это значение заменяет соответствующую переменную в SQL. Если в вопросе несколько фильтров, то их можно перетащить и изменить их порядок."),_=(0,e.uE)('<p>Этот пример определяет переменную <code>cat</code> позволяющую динамически изменять условие <code>WHERE</code>:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>SELECT count(*)\nFROM products\nWHERE category = {{cat}}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="тип-переменнои-field-filter" tabindex="-1"><a class="header-anchor" href="#тип-переменнои-field-filter" aria-hidden="true">#</a> Тип переменной Field Filter</h2><p>Установка переменной типа <code>field filter</code> позволяет вам сопоставить её с любым полем в таблице текущей базы данных и отображает выпадающий список со значениями выбранного поля. Переменные <code>field filter</code> также позволяют соединить SQL-запрос с фильтром дашборда если вопрос помещён на дашборд.</p><p>Переменные <code>field filter</code> вставляют SQL похожий на тот что генерируется графическим построителем запросов, когда добавляется фильтр по существующему столбцу. Это полезно потому, что позволяет вам делать такие вещи как вставка динамического диапазона дат в SQL. Переменная с типом <code>field filter</code> обязательно должна быть привязана к столбцу и находится внутри выражения <code>WHERE</code>.</p><p>Примечание: псевдонимы таблиц не поддерживаются.</p><p>Пример:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>\n<span class="token keyword">FROM</span> products\n<span class="token keyword">WHERE</span> {{created_at}}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="создание-фильтров-sql-вопроса-используя-переменные-field-filter" tabindex="-1"><a class="header-anchor" href="#создание-фильтров-sql-вопроса-используя-переменные-field-filter" aria-hidden="true">#</a> Создание фильтров SQL-вопроса используя переменные field filter</h2>',9),L=(0,e.Uk)("Сперва, вставьте переменную в SQL, например, "),U=(0,e.Uk)(". Затем, в боковой панели выберите тип "),w=(0,e._)("code",null,"Field Filter",-1),x=(0,e.Uk)(" и выберите поле для сопоставления с переменной. Чтобы отобразился виджет фильтра, тип поля установленный в секции "),R=(0,e._)("strong",null,"Data Model",-1),S=(0,e.Uk)(" панели администрирования должен быть одним из следующих:"),q=(0,e.uE)('<ul><li>Category</li><li>City</li><li>Entity Key</li><li>Entity Name</li><li>Foreign Key</li><li>State</li><li>UNIX Timestamp (Seconds)</li><li>UNIX Timestamp (Milliseconds)</li><li>ZIP or Postal Code</li></ul><p>Поле может быть также датой с временем (можно оставить как <code>No special type</code> в модели данных).</p><p>Вы увидите выпадающий список подписанный <strong>Widget</strong>, который позволяет вам выбрать тип виджета подходящего для вопроса. Это особенно полезно для полей с типом дата и время. Значение <strong>None</strong> скрывает виджет. Примечание: если настроек виджета нет, проверьте что поле принадлежит к одному из указанных выше типов, и затем попробуйте вручную синхронизировать базу данных из секции <strong>Database</strong> панели администратора чтобы заставить Metabase сканировать и кешировать значения поля.</p><p>Виджет не отображается если переменная связана с полем помеченным как:</p><ul><li>Avatar Image URL</li><li>Description</li><li>Email</li><li>Enum</li><li>Field containing JSON</li><li>Image URL</li><li>Number</li><li>Latitude</li><li>Longitude</li><li>URL</li></ul><h2 id="значение-по-умолчанию" tabindex="-1"><a class="header-anchor" href="#значение-по-умолчанию" aria-hidden="true">#</a> Значение по умолчанию</h2><p>Если вы введёте значение по умолчанию для фильтра, это значение будет выбрано в фильтре при открытии вопроса. Если вы очистите фильтр, то значение не будет передано в переменную, даже значение по умолчанию. Значение по умолчанию не оказывает эффект на поведение SQL-вопроса при просмотре дашборда.</p><h2 id="значение-по-умолчанию-в-запросе" tabindex="-1"><a class="header-anchor" href="#значение-по-умолчанию-в-запросе" aria-hidden="true">#</a> Значение по умолчанию в запросе</h2><p>Значение по умолчанию можно определить напрямую в запросе, полезно для сложных значений по умолчанию.</p><p>Пример с текущей датой:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> p<span class="token punctuation">.</span><span class="token operator">*</span>\n<span class="token keyword">FROM</span> products p\n<span class="token keyword">WHERE</span> p<span class="token punctuation">.</span>createdAt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> {{dateOfCreation}} <span class="token comment">#]]CURRENT_DATE()</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="необязательное-выражение" tabindex="-1"><a class="header-anchor" href="#необязательное-выражение" aria-hidden="true">#</a> Необязательное выражение</h2>',12),D=(0,e.Uk)("Необязательные выражения в запросе добавляются так: "),F=(0,e.Uk)(". Если переменная получает значение, то полное выражение помещается в запрос. Если нет, то полное выражение игнорируется."),M=(0,e.uE)('<p>В этом примере, если значение не будет помещено в <code>cat</code> из виджета или URL, то запрос вернёт все строки из таблицы <code>products</code>. Но если в <code>cat</code> будет значение, то запрос выберет только продукты выбранной в виджете категории.</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>\n<span class="token keyword">FROM</span> products\n<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">WHERE</span> category <span class="token operator">=</span> {{cat}}<span class="token punctuation">]</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>При использовании нескольких необязательных выражений вы должны добавить как минимум одно обычное выражение <code>WHERE</code> а за ним необязательные выражения начинающиеся с <code>AND</code>.</p><p>Пример:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>\n<span class="token keyword">FROM</span> products\n<span class="token keyword">WHERE</span> <span class="token boolean">True</span>\n  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">AND</span> id <span class="token operator">=</span> {{id}}<span class="token punctuation">]</span><span class="token punctuation">]</span>\n  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">AND</span> category <span class="token operator">=</span> {{category}}<span class="token punctuation">]</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Когда используется <code>field filter</code>, название столбца не должно включаться в SQL. Вместо этого, переменная должна быть связана с полем в боковой панели.</p><p>Пример:</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>\n<span class="token keyword">FROM</span> products\n<span class="token keyword">WHERE</span> <span class="token boolean">True</span>\n  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">AND</span> {{id}}<span class="token punctuation">]</span><span class="token punctuation">]</span>\n  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">AND</span> {{category}}<span class="token punctuation">]</span><span class="token punctuation">]</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="далее-автоматическое-x-ray-исследование" tabindex="-1"><a class="header-anchor" href="#далее-автоматическое-x-ray-исследование" aria-hidden="true">#</a> Далее: Автоматическое x-ray исследование</h2><p>Изучите как просто и быстро смотреть автоматические исследования данных с мощной функцией Metabase x-ray.</p>',10),C={render:function(a,n){const s=(0,e.up)("OutboundLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[(0,e._)("h1",t,[p,(0,e.Uk)(" "+(0,l.zw)(a.$frontmatter.title),1)]),(0,e._)("p",null,[o,(0,e._)("a",i,[c,(0,e.Wm)(s)]),r]),d,u,k,b,m,(0,e._)("p",null,[g,(0,e._)("code",null,(0,l.zw)(a.variable_name),1),h,f,v,E,y]),_,(0,e._)("p",null,[L,(0,e._)("code",null,(0,l.zw)(a.my_var),1),U,w,x,R,S]),q,(0,e._)("p",null,[D,(0,e._)("code",null,"[[скобки вокруг "+(0,l.zw)(a.переменная)+"]]",1),F]),M],64)}}}}]);