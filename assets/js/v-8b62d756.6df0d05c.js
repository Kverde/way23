"use strict";(self.webpackChunkway23=self.webpackChunkway23||[]).push([[5115],{88772:(s,n,a)=>{a.r(n),a.d(n,{data:()=>e});const e={key:"v-8b62d756",path:"/linux-mkfs-mount-fstab.html",title:"Создание и монтирование файловой системы в Linux (mkfs, mount, blkid, fstab)",lang:"ru-RU",frontmatter:{title:"Создание и монтирование файловой системы в Linux (mkfs, mount, blkid, fstab)",date:"2023-12-16",categories:["Linux"],tags:["mkfs","mount","blkid","fstab"]},excerpt:"",headers:[],filePathRelative:"linux-mkfs-mount-fstab.md",git:{updatedTime:1702806927e3}}},7297:(s,n,a)=>{a.r(n),a.d(n,{default:()=>h});var e=a(66252),p=a(3577);const t={id:"frontmatter-title",tabindex:"-1"},l=(0,e._)("a",{class:"header-anchor",href:"#frontmatter-title","aria-hidden":"true"},"#",-1),o=(0,e.Uk)("После "),c=(0,e.Uk)("разметки диска"),r=(0,e.Uk)(", на разделах нужно создать файловую систему. Сделать это можно программой "),u=(0,e._)("code",null,"mkfs",-1),i=(0,e.Uk)(". в систему добавлен диск "),b=(0,e._)("code",null,"sdb",-1),k=(0,e.Uk)(" с двумя разделами: "),m=(0,e._)("code",null,"sdb1",-1),d=(0,e.Uk)(" и "),v=(0,e._)("code",null,"sdb2",-1),f=(0,e.Uk)("."),g=(0,e.uE)('<div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$sudo</span> <span class="token function">fdisk</span> -l\n<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> user: \n\n\nDisk /dev/sdb: <span class="token number">1</span> GiB, <span class="token number">1073741824</span> bytes, <span class="token number">2097152</span> sectors\nDisk model: VBOX HARDDISK   \nUnits: sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes\nSector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes\nI/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes\nDisklabel type: gpt\nDisk identifier: 298E01AB-6142-C446-AB5B-EF5AF4D7D40D\n\nDevice      Start     End Sectors  Size Type\n/dev/sdb1    <span class="token number">2048</span>  <span class="token number">821247</span>  <span class="token number">819200</span>  400M Linux filesystem\n/dev/sdb2  <span class="token number">821248</span> <span class="token number">2097118</span> <span class="token number">1275871</span>  623M Linux filesystem\n\n\nDisk /dev/sda: <span class="token number">30</span> GiB, <span class="token number">32212254720</span> bytes, <span class="token number">62914560</span> sectors\nDisk model: VBOX HARDDISK   \nUnits: sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes\nSector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes\nI/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes\nDisklabel type: dos\nDisk identifier: 0x5bfff3f8\n\nDevice     Boot Start      End  Sectors Size Id Type\n/dev/sda1  *     <span class="token number">2048</span> <span class="token number">62910539</span> <span class="token number">62908492</span>  30G <span class="token number">83</span> Linux\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>Для создания файловой системы в команду <code>mkfs</code> нужно передать тип файловой системы (параметр <code>-t</code>) и путь к разделу. Создадим на двух разделах две разные файловые системы: <code>ext4</code> и</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>✗<span class="token punctuation">]</span>─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$sudo</span> <span class="token function">mkfs</span> -t ext4 /dev/sdb1\n<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> user: \n<span class="token function">mke2fs</span> <span class="token number">1.46</span>.6 <span class="token punctuation">(</span><span class="token number">1</span>-Feb-2023<span class="token punctuation">)</span>\nCreating filesystem with <span class="token number">409600</span> 1k blocks and <span class="token number">102400</span> inodes\nFilesystem UUID: a6411a93-7813-4431-9203-f53209211e96\nSuperblock backups stored on blocks: \n\t<span class="token number">8193</span>, <span class="token number">24577</span>, <span class="token number">40961</span>, <span class="token number">57345</span>, <span class="token number">73729</span>, <span class="token number">204801</span>, <span class="token number">221185</span>, <span class="token number">401409</span>\n\nAllocating group tables: <span class="token keyword">done</span>                            \nWriting inode tables: <span class="token keyword">done</span>                            \nCreating journal <span class="token punctuation">(</span><span class="token number">8192</span> blocks<span class="token punctuation">)</span>: <span class="token keyword">done</span>\nWriting superblocks and filesystem accounting information: <span class="token keyword">done</span> \n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>└──╼ <span class="token variable">$sudo</span> <span class="token function">mkfs</span> -t btrfs /dev/sdb2\nbtrfs-progs v6.1.3 \nSee http://btrfs.wiki.kernel.org <span class="token keyword">for</span> <span class="token function">more</span> information.\n\nNOTE: several default settings have changed <span class="token keyword">in</span> version <span class="token number">5.15</span>, please <span class="token function">make</span> sure\n      this does not affect your deployments:\n      - DUP <span class="token keyword">for</span> metadata <span class="token punctuation">(</span>-m dup<span class="token punctuation">)</span>\n      - enabled no-holes <span class="token punctuation">(</span>-O no-holes<span class="token punctuation">)</span>\n      - enabled free-space-tree <span class="token punctuation">(</span>-R free-space-tree<span class="token punctuation">)</span>\n\nLabel:              <span class="token punctuation">(</span>null<span class="token punctuation">)</span>\nUUID:               9d9c2052-2317-4ffa-9001-719342a91218\nNode size:          <span class="token number">16384</span>\nSector size:        <span class="token number">4096</span>\nFilesystem size:    <span class="token number">622</span>.98MiB\nBlock group profiles:\n  Data:             single            <span class="token number">8</span>.00MiB\n  Metadata:         DUP              <span class="token number">32</span>.00MiB\n  System:           DUP               <span class="token number">8</span>.00MiB\nSSD detected:       no\nZoned device:       no\nIncompat features:  extref, skinny-metadata, no-holes\nRuntime features:   free-space-tree\nChecksum:           crc32c\nNumber of devices:  <span class="token number">1</span>\nDevices:\n   ID        SIZE  <span class="token environment constant">PATH</span>\n    <span class="token number">1</span>   <span class="token number">622</span>.98MiB  /dev/sdb2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>Вывод информации при создании разных файловых систем различается. В двух случаях команда возвращает UUID — уникальный идентификатор файловой системы. По нему можно ссылаться на файловый системе вместе пути к разделу вроде <code>/dev/sdb1</code>, так как этот путь зависит от порядка инициализации устройств и может изменится, а идентификатор файловой системы записан на диске и не меняется.</p><p>Создадим два каталога.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$mkdir</span> disk1 disk2\n┌─<span class="token punctuation">[</span>✗<span class="token punctuation">]</span>─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$ls</span> -l\ntotal <span class="token number">0</span>\ndrwxr-xr-x <span class="token number">1</span> user user <span class="token number">0</span> Dec <span class="token number">16</span> 08:44 disk1\ndrwxr-xr-x <span class="token number">1</span> user user <span class="token number">0</span> Dec <span class="token number">16</span> 08:44 disk2\n\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Теперь примонтируем две файловые системы, одну с помощью пути к диску, а вторую с указанием UUID файловой системы. Команда <code>mount</code> монтирует файловую систему, первый параметр — раздел, второй — точка монтирования файловой системы.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$sudo</span> <span class="token function">mount</span> /dev/sdb1 ./disk1\n┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$sudo</span> <span class="token function">mount</span> <span class="token assign-left variable">UUID</span><span class="token operator">=</span>9d9c2052-2317-4ffa-9001-719342a91218 ./disk2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Параметры каталогов теперь изменились, у них стал другой владелец и группа:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>✗<span class="token punctuation">]</span>─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$ls</span> -l\ntotal <span class="token number">17</span>\ndrwxr-xr-x <span class="token number">3</span> root root <span class="token number">1024</span> Dec <span class="token number">16</span> 08:37 disk1\ndrwxr-xr-x <span class="token number">1</span> root root    <span class="token number">0</span> Dec <span class="token number">16</span> 08:39 disk2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Команда <code>mount</code> без параметров выводит список примонтированных файловых систем.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$mount</span> <span class="token operator">|</span> <span class="token function">grep</span> /sdb\n/dev/sdb1 on /home/user/test/disk1 <span class="token builtin class-name">type</span> ext4 <span class="token punctuation">(</span>rw,relatime<span class="token punctuation">)</span>\n/dev/sdb2 on /home/user/test/disk2 <span class="token builtin class-name">type</span> btrfs <span class="token punctuation">(</span>rw,relatime,space_cache<span class="token operator">=</span>v2,subvolid<span class="token operator">=</span><span class="token number">5</span>,subvol<span class="token operator">=</span>/<span class="token punctuation">)</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>В выводе команды присутствуют:</p><ol><li>Примонтированное устройство (раздел диска)</li><li>Точка монтирования</li><li>Тип файловой системы</li><li>Параметры монтирования</li></ol><p>Идентификаторы файловых систем так же можно посмотреть командой <code>blkid</code>:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$blkid</span>\n/dev/sda1: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;3b8dda7f-a34a-40b6-bc8b-d90d2087258b&quot;</span> <span class="token assign-left variable">UUID_SUB</span><span class="token operator">=</span><span class="token string">&quot;bf469f0b-dc85-4689-8612-8960300d1402&quot;</span> <span class="token assign-left variable">BLOCK_SIZE</span><span class="token operator">=</span><span class="token string">&quot;4096&quot;</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;btrfs&quot;</span> <span class="token assign-left variable">PARTUUID</span><span class="token operator">=</span><span class="token string">&quot;5bfff3f8-01&quot;</span>\n/dev/sdb1: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;a6411a93-7813-4431-9203-f53209211e96&quot;</span> <span class="token assign-left variable">BLOCK_SIZE</span><span class="token operator">=</span><span class="token string">&quot;1024&quot;</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;ext4&quot;</span> <span class="token assign-left variable">PARTUUID</span><span class="token operator">=</span><span class="token string">&quot;64e9d72b-4c96-ab44-ba49-78f5df5d3b94&quot;</span>\n/dev/sdb2: <span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;9d9c2052-2317-4ffa-9001-719342a91218&quot;</span> <span class="token assign-left variable">UUID_SUB</span><span class="token operator">=</span><span class="token string">&quot;6a24be71-65e3-4207-92f6-6d47736422e0&quot;</span> <span class="token assign-left variable">BLOCK_SIZE</span><span class="token operator">=</span><span class="token string">&quot;4096&quot;</span> <span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;btrfs&quot;</span> <span class="token assign-left variable">PARTUUID</span><span class="token operator">=</span><span class="token string">&quot;9ed5870c-444d-7146-8623-8c99d2015cdb&quot;</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Если попытаться записать файл в примонтированный диск, то окажется, что у пользователя недостаточно прав.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$cd</span> disk2\n┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test/disk2<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$touch</span> file.txt\ntouch: cannot <span class="token function">touch</span> <span class="token string">&#39;file.txt&#39;</span><span class="token builtin class-name">:</span> Permission denied\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Это можно исправить изменив владельца точки монтирования.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test/disk2<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$cd</span> <span class="token punctuation">..</span>\n┌─<span class="token punctuation">[</span>✗<span class="token punctuation">]</span>─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$sudo</span> <span class="token function">chown</span> user ./disk2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Теперь прав достаточно:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$echo</span> hello <span class="token operator">&gt;</span> ./disk2/text.txt\n┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$ls</span> -l ./disk2\ntotal <span class="token number">4</span>\n-rw-r--r-- <span class="token number">1</span> user user <span class="token number">6</span> Dec <span class="token number">16</span> 09:27 text.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Размонтируем диск. В команде <code>umount</code> можно указать диск или точку монтирования.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$sudo</span> <span class="token function">umount</span> ./disk2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Теперь файл пропал из каталога.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$ls</span> -l ./disk2\ntotal <span class="token number">0</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Примонтируем снова и файл снова будет на месте.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$sudo</span> <span class="token function">mount</span> /dev/sdb2 ./disk2\n┌─<span class="token punctuation">[</span>user@parrot<span class="token punctuation">]</span>─<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>\n└──╼ <span class="token variable">$cat</span> ./disk2/text.txt \nhello\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Чтобы не монтировать файловую систему вручную, есть специальный файл <code>/etc/fstab</code>, который монтирует все перечисленные в нём файловые системы при запуске Linux.</p><p>Добавим в него строку</p><div class="language-txt ext-txt line-numbers-mode"><pre class="language-txt"><code>UUID=&quot;9d9c2052-2317-4ffa-9001-719342a91218&quot; /home/user/test/disk2  btrfs   defaults,noatime,nodiratime 0 2\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>После перезагрузки файловая систему будет сразу примонтирована.</p>',33),h={render:function(s,n){const a=(0,e.up)("RouterLink");return(0,e.wg)(),(0,e.iD)(e.HY,null,[(0,e._)("h1",t,[l,(0,e.Uk)(" "+(0,p.zw)(s.$frontmatter.title),1)]),(0,e._)("p",null,[o,(0,e.Wm)(a,{to:"/linux-fdisk.html"},{default:(0,e.w5)((()=>[c])),_:1}),r,u,i,b,k,m,d,v,f]),g],64)}}}}]);