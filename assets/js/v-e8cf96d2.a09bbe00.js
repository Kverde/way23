"use strict";(self.webpackChunkway23=self.webpackChunkway23||[]).push([[61],{32679:(e,t,o)=>{o.r(t),o.d(t,{data:()=>n});const n={key:"v-e8cf96d2",path:"/%D0%BD%D0%BE%D0%BC%D0%B5%D1%80-%D1%82%D0%B5%D0%BA%D1%83%D1%89%D0%B5%D0%B9-%D1%80%D0%B5%D0%B2%D0%B8%D0%B7%D0%B8%D0%B8-svn-%D0%B2-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B5-delphi.html",title:"Номер ревизии SVN в проекте Delphi",lang:"ru-RU",frontmatter:{title:"Номер ревизии SVN в проекте Delphi",date:"2017-01-27",categories:["Delphi"],tags:["Delphi"]},excerpt:"",headers:[],filePathRelative:"номер-текущей-ревизии-svn-в-проекте-delphi.md",git:{updatedTime:1692859375e3}}},83838:(e,t,o)=>{o.r(t),o.d(t,{default:()=>B});var n=o(66252),r=o(3577);const u={id:"frontmatter-title",tabindex:"-1"},p=(0,n._)("a",{class:"header-anchor",href:"#frontmatter-title","aria-hidden":"true"},"#",-1),i=(0,n._)("p",null,"В этой инструкции показано как настроить автоматическое добавлении номера ревизии в Delphi программу из рабочей копии SVN в которой находится собираемый проект. Номер ревизия отображается в свойствах файла, а из кода доступен в виде константы.",-1),l=(0,n.Uk)("Устанавливаем "),d={href:"http://www.collab.net/downloads/subversion",target:"_blank",rel:"noopener noreferrer"},a=(0,n.Uk)("консольный клиент SVN"),c=(0,n.Uk)("."),q=(0,n.uE)("<p>Создаем и сохраняем в Delphi новый проект.</p><p>Рядом с файлом проекта помещаем два файла: <code>version.rc.tmpl</code> - шаблон для файла ресурсов и скрипт получения ревизии <code>_CreateInclude.bat</code>.</p><p>1 VERSIONINFO FILEVERSION 1,0,0,---WCREV--- PRODUCTVERSION 1,5 FILEOS 0x4 FILETYPE 0x1 FILESUBTYPE 0x0L FILEFLAGSMASK 0x3fL { BLOCK &quot;StringFileInfo&quot; { BLOCK &quot;040904E4&quot; { VALUE &quot;CompanyName&quot;, &quot;\\0&quot; VALUE &quot;FileDescription&quot;, &quot;\\0&quot; VALUE &quot;FileVersion&quot;, &quot;1.0.0.---WCREV---\\0&quot; VALUE &quot;InternalName&quot;, &quot;\\0&quot; VALUE &quot;LegalCopyright&quot;, &quot;\\0&quot; VALUE &quot;LegalTrademarks&quot;, &quot;\\0&quot; VALUE &quot;OriginalFilename&quot;, &quot;\\0&quot; VALUE &quot;ProductName&quot;, &quot;\\0&quot; VALUE &quot;ProductVersion&quot;, &quot;1.5\\0&quot; VALUE &quot;Author&quot;, &quot;\\0&quot; } } BLOCK &quot;VarFileInfo&quot; { VALUE &quot;Translation&quot;, 0x0419 0x04E4 } }</p><p>cd %~dp0</p><p>del _IncludeBuildInfo.inc</p><p>chcp 1251</p><p>rem Get revision</p><p>svn info | find /i &quot;Last Changed Rev&quot;&gt;__rev.txt</p><p>SET /p rev=&lt;__rev.txt SET rev=%rev:~18%</p><p>del __rev.txt</p><p>rem create include</p><p>del _IncludeBuildInfo.inc</p><p>echo const cRevision = &#39;---WCREV---&#39;; cBuildInfo = &#39;BuildDate: &quot;%DATE% %TIME%&quot;; User: &quot;%USERNAME%&quot;; COMPUTERNAME: &quot;%COMPUTERNAME%&quot;&#39;;&gt;&gt; _IncludeBuildInfo.inc</p><p>reFind.exe _IncludeBuildInfo.inc &quot;/P:---WCREV---&quot; &quot;/R:%rev%&quot; /B:2</p><p>rem create res</p><p>del version.rc</p><p>copy version.rc.tmpl version.rc</p><p>reFind.exe version.rc &quot;/P:---WCREV---&quot; &quot;/R:%rev%&quot; /B:2</p><p>BRCC32.exe -w32 -v -c1251 -m &quot;%~dp0version.rc&quot; -foversion</p>",19),s={href:"http://docwiki.embarcadero.com/RADStudio/XE5/en/ReFind.exe,_the_Search_and_Replace_Utility_Using_Perl_RegEx_Expressions",target:"_blank",rel:"noopener noreferrer"},E=(0,n.Uk)("reFind.exe"),_=(0,n.Uk)(" - утилита из набора Delphi."),D=(0,n.uE)('<p>При запуске <code>_CreateInclude.bat</code> создаются два файла <code>version.RES</code> и <code>_IncludeBuildInfo.inc</code>.</p><p>const cRevision = &#39;1234&#39;; cBuildInfo = &#39;BuildDate: &quot;20.01.2017 16:21:06,51&quot;; User: &quot;QQQ&quot;; COMPUTERNAME: &quot;QQQ1&quot;&#39;;</p><p>Подключаем их в коде приложения</p><p>var Form1: TForm1;</p><p>// подключение ресурса для вывода номера ревизии в свойствах файла {$R version.RES}</p><p>// подключение файла с константой в которой номер ревизии {$I &#39;_IncludeBuildInfo.inc&#39;}</p><p>implementation</p><p>{$R *.dfm}</p><p>procedure TForm1.FormCreate(Sender: TObject); begin // используем константу из _IncludeBuildInfo.inc Caption := cRevision; end;</p><p>В настройке проекта, для <code>All configurations</code>, добавляем запуск <code>_CreateInclude.bat</code> перед сборкой</p><p><img src="images/delphi_svn_1-300x109.png" alt=""></p><p>Компилируем проект, ревизия отображается в свойствах файла и в заголовке формы.</p><p><img src="images/delphi_svn_2.png" alt=""></p><p><img src="images/delphi_svn_3-300x185.png" alt=""></p>',14),m={href:"https://github.com/Kverde/way23_examples/tree/master/Delphi/SvnRevision",target:"_blank",rel:"noopener noreferrer"},h=(0,n.Uk)("Пример на GitHub"),B={render:function(e,t){const o=(0,n.up)("OutboundLink");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("h1",u,[p,(0,n.Uk)(" "+(0,r.zw)(e.$frontmatter.title),1)]),i,(0,n._)("p",null,[l,(0,n._)("a",d,[a,(0,n.Wm)(o)]),c]),q,(0,n._)("p",null,[(0,n._)("a",s,[E,(0,n.Wm)(o)]),_]),D,(0,n._)("p",null,[(0,n._)("a",m,[h,(0,n.Wm)(o)])])],64)}}}}]);