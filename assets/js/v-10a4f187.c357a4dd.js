"use strict";(self.webpackChunkway23=self.webpackChunkway23||[]).push([[4526],{3013:(s,n,e)=>{e.r(n),e.d(n,{data:()=>a});const a={key:"v-10a4f187",path:"/linux-suid-ssgid-sticky-bit.html",title:"Особые виды прав в Linux: SUID, SGID и Sticky bit",lang:"ru-RU",frontmatter:{title:"Особые виды прав в Linux: SUID, SGID и Sticky bit",date:"2023-11-20",categories:["Linux"],tags:["chmod"]},excerpt:"",headers:[{level:2,title:"Ссылки",slug:"ссылки",children:[]}],filePathRelative:"linux-suid-ssgid-sticky-bit.md",git:{updatedTime:1700490423e3}}},17257:(s,n,e)=>{e.r(n),e.d(n,{default:()=>h});var a=e(66252),r=e(3577);const p={id:"frontmatter-title",tabindex:"-1"},t=(0,a._)("a",{class:"header-anchor",href:"#frontmatter-title","aria-hidden":"true"},"#",-1),l=(0,a.uE)('<p>Кроме прав на чтение, запись и исполнение, в Linux есть три особых вида прав для файлов и каталогов: SUID, SGID и Sticky bit.</p><p>SUID используется только для файлов. При выполнении файла с признаком SUID, файл выполняется не с правами запустившего его пользователя, а с правами владельца файла. Такой вид прав установлен у программы <code>passwd</code>, чтобы она могла редактировать пароли пользователя в файле <code>shadow</code>, доступ на запись в этот файл есть только у <code>root</code>.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>user@debian-server:~$ <span class="token function">ls</span> -l /etc/shadow\n-rw-r----- <span class="token number">1</span> root shadow <span class="token number">1051</span> ноя <span class="token number">14</span> 06:38 /etc/shadow\nuser@debian-server:~$ <span class="token function">ls</span> -l /bin/passwd\n-rwsr-xr-x <span class="token number">1</span> root root <span class="token number">68248</span> мар <span class="token number">23</span>  <span class="token number">2023</span> /bin/passwd\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>В командах <code>ls</code> и <code>stat</code> метка SUID отображается в позиции права на выполнения в разделе для пользователя. Если у файла есть права на выполнение и SUID то в этом месте будет стоять маленькая <code>s</code> — <code>rws</code>, а если прав на выполнения файла нет, то большая — <code>rwS</code>. То же самое совпадает с меткой SUID, только она находится в разделе прав для группы.</p>',4),c=(0,a.Uk)("Флаг SUID "),u={href:"https://unix.stackexchange.com/questions/364/allow-setuid-on-shell-scripts",target:"_blank",rel:"noopener noreferrer"},b=(0,a.Uk)("не работает в bash скриптах"),i=(0,a.Uk)("."),o=(0,a.uE)('<p>SGID может применяться аналогично SUID, при запуске файла используются права группы не того кто запустил, а права группы файла. Но у SGID есть и другое применение: в каталоге с такими правами файлы создаются не с группой создателя файла, а с группой родительского каталога.</p><p>Проверим это, для этого создадим каталог и создадим в нем два файла: первый без SGID у каталога, а второй после выставления метки SGID.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>user@debian-server:~/test$ <span class="token function">mkdir</span> parent\nuser@debian-server:~/test$ <span class="token function">chgrp</span> docker parent\nuser@debian-server:~/test$ <span class="token function">ls</span> -l\ntotal <span class="token number">4</span>\ndrwxr-xr-x <span class="token number">2</span> user docker <span class="token number">4096</span> ноя <span class="token number">20</span> 09:01 parent\n\nuser@debian-server:~/test$ <span class="token function">touch</span> ./parent/file1.txt\n\nuser@debian-server:~/test$ <span class="token function">chmod</span> g+s parent\nuser@debian-server:~/test$ <span class="token function">ls</span> -l\ntotal <span class="token number">4</span>\ndrwxr-sr-x <span class="token number">2</span> user docker <span class="token number">4096</span> ноя <span class="token number">20</span> 09:04 parent\n\nuser@debian-server:~/test$ <span class="token function">touch</span> ./parent/file2.txt\n\nuser@debian-server:~/test$ <span class="token function">ls</span> -l ./parent\ntotal <span class="token number">0</span>\n-rw-r--r-- <span class="token number">1</span> user user   <span class="token number">0</span> ноя <span class="token number">20</span> 09:03 file1.txt\n-rw-r--r-- <span class="token number">1</span> user docker <span class="token number">0</span> ноя <span class="token number">20</span> 09:04 file2.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>Параметр Sticky bit отображается в разделе прав для остальных, так же как с SUID и SGID, только вместо символа <code>s</code> используется символ <code>t</code>. Если этот параметр установлен у каталога, то файлы из этого каталога может удалить только их владелец. Проверим это, создадим каталог, в нем несколько файлов с разными владельцами и попробуем их удалить без признака Sticky bit и с этим признаком.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>user@debian-server:~/test$ <span class="token function">ls</span> -l\ntotal <span class="token number">4</span>\ndrwxr-xrwx <span class="token number">2</span> root root <span class="token number">4096</span> ноя <span class="token number">20</span> 09:22 parent\nuser@debian-server:~/test$ <span class="token function">ls</span> -l ./parent\ntotal <span class="token number">0</span>\n-rw-r--r-- <span class="token number">1</span> user01 user01 <span class="token number">0</span> ноя <span class="token number">20</span> 09:18 file1.txt\n-rw-r--r-- <span class="token number">1</span> user   user   <span class="token number">0</span> ноя <span class="token number">20</span> 09:18 file2.txt\n-rw-r--r-- <span class="token number">1</span> user01 user01 <span class="token number">0</span> ноя <span class="token number">20</span> 09:18 file3.txt\n-rw-r--r-- <span class="token number">1</span> user   user   <span class="token number">0</span> ноя <span class="token number">20</span> 09:18 file4.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Без Sticky bit файлы удаляются.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>user@debian-server:~/test$ <span class="token function">rm</span> -f ./parent/file1.txt \nuser@debian-server:~/test$ <span class="token function">rm</span> -f ./parent/file2.txt \nuser@debian-server:~/test$ <span class="token function">ls</span> -l ./parent\ntotal <span class="token number">0</span>\n-rw-r--r-- <span class="token number">1</span> user01 user01 <span class="token number">0</span> ноя <span class="token number">20</span> 09:18 file3.txt\n-rw-r--r-- <span class="token number">1</span> user   user   <span class="token number">0</span> ноя <span class="token number">20</span> 09:18 file4.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Теперь добавим Sticky bit и попробуем удалить файлы.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>user@debian-server:~/test$ <span class="token function">sudo</span> <span class="token function">chmod</span> o+t ./parent\nuser@debian-server:~/test$ <span class="token function">ls</span> -l\ntotal <span class="token number">4</span>\ndrwxr-xrwt <span class="token number">2</span> root root <span class="token number">4096</span> ноя <span class="token number">20</span> 09:23 parent\n\nuser@debian-server:~/test$ <span class="token function">rm</span> -f ./parent/file3.txt \nrm: cannot remove <span class="token string">&#39;./parent/file3.txt&#39;</span><span class="token builtin class-name">:</span> Operation not permitted\nuser@debian-server:~/test$ <span class="token function">rm</span> -f ./parent/file4.txt \nuser@debian-server:~/test$ <span class="token function">ls</span> -l ./parent\ntotal <span class="token number">0</span>\n-rw-r--r-- <span class="token number">1</span> user01 user01 <span class="token number">0</span> ноя <span class="token number">20</span> 09:18 file3.txt\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="ссылки" tabindex="-1"><a class="header-anchor" href="#ссылки" aria-hidden="true">#</a> Ссылки</h2>',10),m={href:"https://habr.com/ru/articles/469667/",target:"_blank",rel:"noopener noreferrer"},d=(0,a.Uk)("Права в Linux (chown, chmod, SUID, GUID, sticky bit, ACL, umask)"),k={href:"https://basis.gnulinux.pro/ru/latest/basis/20/20._%D0%9F%D1%80%D0%B0%D0%B2%D0%B0_%D0%BD%D0%B0_%D1%84%D0%B0%D0%B9%D0%BB%D1%8B.html",target:"_blank",rel:"noopener noreferrer"},f=(0,a.Uk)("Основы GNU/Linux: 20. Права на файлы"),h={render:function(s,n){const e=(0,a.up)("OutboundLink");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("h1",p,[t,(0,a.Uk)(" "+(0,r.zw)(s.$frontmatter.title),1)]),l,(0,a._)("p",null,[c,(0,a._)("a",u,[b,(0,a.Wm)(e)]),i]),o,(0,a._)("ul",null,[(0,a._)("li",null,[(0,a._)("a",m,[d,(0,a.Wm)(e)])]),(0,a._)("li",null,[(0,a._)("a",k,[f,(0,a.Wm)(e)])])])],64)}}}}]);